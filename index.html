<!DOCTYPE html>
<html lang="fr">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>RubMaxApp</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png" type="image/png">
  <meta name="theme-color" content="#ffffff">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="https://script.google.com/macros/s/AKfycbwoTyj8mpGYPfWCOxszGA-SPYTSBsJbJoHyFKgIr-b5xSAu-CO9pgE3bCebLGAWCVDnPg/exec?page=manifest">

  <style>
    /* Overlay loader plein √©cran */
    #page-loader {
      position: fixed;
      inset: 0;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
    }
    .spinner {
      width: 64px; height: 64px;
      border: 6px solid #e0e0e0;
      border-top: 6px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* On cache l'app sous le loader (transition douce optionnelle) */
    #app { opacity: 0; transition: opacity .2s; }
    #app.app-ready { opacity: 1; }
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="page-loader"><div class="spinner"></div></div>

  <!-- Tout le contenu de la page est dans #app -->
  <div id="app">
    <!-- En-t√™te fixe -->
    <div class="fixed-header">
      <div class="logo-container" style="display: flex">
        <p style="font-weight: bold; color: bleu; font-size: 20px;"><strong>RECARGA CELULAR INT.</strong>strong></p>
        <button id="installBtn" style="
          background-color:;
          color: white;
          padding: 2px 2px;
          font-size: 18px;
          border: none;
          border-radius: 8px;
          box-shadow: 0 0 10px rgba(0,0,0,0.2);
          z-index: 9999;
          cursor: pointer;
        ">üì≤</button>
      </div>
      <div class="nav-scroll-container" id="nav-container">
        <div id="section-nav" class="section-nav"></div>
      </div>
    </div>

    <br>

    <!-- Contenu principal -->
    <div class="container main-content">
      <div id="produits"></div>
    </div>

    <!-- Popup avec galerie d'images -->
    <div id="popup" class="popup">
      <span class="popup-close" onclick="closePopup()">&times;</span>
      <div class="gallery-container">
        <div class="image-gallery">
          <div class="gallery-images" id="gallery-images"></div>
          <div class="gallery-buttons">
            <button class="gallery-btn prev-btn" onclick="prevImage()">‚ùÆ</button>
            <button class="gallery-btn next-btn" onclick="nextImage()">‚ùØ</button>
          </div>
          <div class="gallery-dots" id="gallery-dots"></div>
        </div>
      </div>
      <div id="popup-details" class="popup-content"></div>
    </div>

    <!-- Description Popup -->
    <div id="description-popup" class="description-popup">
      <div class="description-popup-content">
        <span class="description-popup-close" onclick="closeDescriptionPopup()">&times;</span>
        <div id="description-content"></div>
      </div>
    </div>

    <!-- Pub Popup -->
    <div id="pub-popup" class="pub-popup">
      <div class="pub-content">
        <button class="pub-close" onclick="closePubPopup()">&times;</button>
        <div id="pub-container"></div>
        <div class="pub-nav-dots" id="pub-dots"></div>
      </div>
    </div>

    <!-- Pied de page -->
    <div id="ped de page">
      <div class="copyright" style="text-align: center;">
        &copy; 2020 RubMax Servicos - Todos os direitos reservados
      </div>
    </div>
    <br>

    <!-- Popup personnalis√© -->
    <div id="popup-welcome" class="popup-overlay" style="display: none;">
      <div class="popup-content">
        <span class="close-btn" onclick="document.getElementById('popup-welcome').style.display='none'">&times;</span>
        <h2>üëã TARIFA DI√ÅRIA !</h2>
        <p>Chargement...</p>
        <button class="popup-ok-btn" onclick="document.getElementById('popup-welcome').style.display='none'">OK</button>
      </div>
    </div>
  </div><!-- /#app -->

  <script src="script.js" defer></script>
  <script src="install.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const loader = document.getElementById("page-loader");
      const app = document.getElementById("app");
      const logoEl = document.getElementById("logo");

      const BASE = "https://script.google.com/macros/s/AKfycbyRHCuLb0IC_fLpQs36UW_zzgnwmDHAJtDZHByZjz3rxHieXr-Xw54yt5NvCEZgzk64xQ/exec";
      const logoUrlAPI = BASE + "?page=logo";
      const dataUrlAPI = BASE + "?page=api";

      // Utilitaires
      const fetchText = (url) => fetch(url, { cache: "no-store" }).then(r => r.text());
      const fetchJSON = (url) => fetch(url, { cache: "no-store" }).then(r => r.json());

      // Attendre que l'image soit r√©ellement charg√©e (avec fallback si url vide/erron√©e)
      const waitForImageLoad = (imgUrl, imgEl) => new Promise((resolve) => {
        if (!imgUrl) return resolve("no-url");
        const test = new Image();
        test.onload = () => { imgEl.src = imgUrl; resolve("ok"); };
        test.onerror = () => { imgEl.alt = "Logo indisponible"; resolve("error"); };
        test.src = imgUrl;
      });

      // 1) R√©cup√®re URL du logo + charge l'image
      // 2) En parall√®le, r√©cup√®re les donn√©es
      Promise.all([
        fetchText(logoUrlAPI).then(url => waitForImageLoad(url, logoEl)),
        fetchJSON(dataUrlAPI)
      ])
      .then(([logoStatus, data]) => {
        // Appelle ta fonction d‚Äôaffichage si elle existe
        if (typeof displayProducts === "function") {
          displayProducts(data);
        }
      })
      .catch(err => {
        console.error("Erreur lors du chargement :", err);
      })
      .finally(() => {
        // Retire le loader et r√©v√®le l'app quoi qu'il arrive
        loader.style.display = "none";
        app.classList.add("app-ready");
      });
    });
  </script>
</body>
</html>






